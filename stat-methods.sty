
\RequirePackage{ifpdf}
\RequirePackage{ifluatex}
\RequirePackage{amsmath}
\RequirePackage{amssymb}

\ifluatex
%%% Language setting for (xe|lua)latex %%%

    \RequirePackage{fontspec}
    \RequirePackage[math-style=TeX]{unicode-math}
    \setmainfont{CMU Serif}
    \setsansfont{CMU Sans Serif}
    \setmonofont{CMU Typewriter Text}
    \newfontfamily{\cyrillicfonttt}{CMU Serif}
    \setmathfont{XITS Math}[math-style=TeX]

    \RequirePackage{polyglossia}
    \setdefaultlanguage[spelling=modern]{russian}

    \RequirePackage{cyrmathtext}
\else
    \RequirePackage{cmap} % для корректной генерации русского текста в PDF
    \RequirePackage[unicode]{hyperref}
    \RequirePackage{mathtext}
    \RequirePackage[T2A]{fontenc}
    \RequirePackage[utf8]{inputenc}
    \RequirePackage[russian]{babel}
    
    % косые интегралы ранят мои патриотические чувства
    \DeclareSymbolFont{lsymb}{U}{euex}{m}{n}
    \DeclareMathSymbol{\intop}{\mathop}{lsymb}{"52}
    \DeclareMathSymbol{\ointop}{\mathop}{lsymb}{"48}
    \DeclareMathSymbol{\smallint}{\mathop}{lsymb}{"52}
\fi

%\RequirePackage{hyperref}
%\hypersetup{%
%    colorlinks = true,%
%    urlcolor = blue,%
%    pdfencoding = auto%
%}

\RequirePackage{xcolor}
\RequirePackage{graphicx}
\RequirePackage{csquotes}

\graphicspath{{./images/}}

\RequirePackage[disable]{todonotes}

\ifpdf
    \RequirePackage{indentfirst} % отступ первого абзаца
    \RequirePackage{icomma} % правильная десятичная запятая

%    \RequirePackage[outputdir=build/pdf, cache=false]{minted}

    \RequirePackage[font=small, labelsep=period]{caption}
    \RequirePackage[pdftex]{geometry}
    \geometry{inner=1.3cm, outer=1.5cm, top=1cm, bottom=1.5cm, 
        footskip=0.8cm}

    \RequirePackage[%
        leftmargin=1pt,%
        topline=false,%
        bottomline=false,%
        skipabove=\medskipamount,%
        skipbelow=\medskipamount
    ]{mdframed}

    % заголовки
    \RequirePackage[small, raggedright, explicit]{titlesec}

    % \setlength{\cftbeforetoctitleskip}{0pt}
    % \setlength{\cftaftertoctitleskip}{1pc}

    \titlespacing{\chapter}{0pt}{2pc}{1pc}
    \titleclass{\chapter}{straight}
    \titleformat{\chapter}[hang]{\large}%
    {\bfseries\thechapter.}{1ex}{\raggedright\bfseries\MakeUppercase{#1}}

    % \renewcommand*{\thesection}{\S\,\arabic{chapter}.\arabic{section}}

    \titlespacing{\section}{0pt}{*2}{*1}
    \titleformat{\section}[hang]{\bfseries}{\thesection.}{1ex}{#1}

    \titlespacing{\subsection}{0pt}{*2}{*1}
    \titleformat{\subsection}[hang]{\small\bfseries}{\thesubsection.}{1ex}{#1}

    \titlespacing{\paragraph}{\parindent}{0pt}{1ex}
    \titleformat{\paragraph}[runin]{\bfseries\sffamily}{}{}{#1}

    \RequirePackage{enumitem}
    \setlist[description]{font={\normalfont\sffamily}}
    %
\fi

\newcommand{\example}[1]{%
    \par
    \begin{mdframed}\small
        \textbf{Пример.~}#1\par
    \end{mdframed}%
}

\newcommand{\exercise}[1]{%
    \par
    \begin{mdframed}\small
        \textbf{Упражнение.~}#1\par
    \end{mdframed}%
}

\newcommand{\note}[1]{%
    \par
    \begin{mdframed}\small
        \textbf{Замечание.~}#1\par
    \end{mdframed}%
}

\newenvironment{longnote}{%
\par
\begin{mdframed}\small
}{%
\end{mdframed}%
}

\newcommand{\disclaimer}[1]{
    \noindent\begin{mdframed}[linecolor=red]
            #1
    \end{mdframed}
}

\newcommand*{\average}[1]{\ensuremath{\left<#1\right>}}
\newcommand*{\limaverage}[1]{\ensuremath{\overline{#1}}}
